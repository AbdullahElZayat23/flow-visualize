async function drawFlow(){closeModal();try{await takeUserInput({title:"Enter steps names without a caller to include e.g Templates",input:"textarea",inputAttributes:{autocapitalize:"off",placeholder:"step name 1\nstep name 2\nstep name 3"},showCancelButton:!0,confirmButtonText:"Submit",allowOutsideClick:!1});loader.style.display="block",setTimeout(()=>{renderValidGraph(),loader.style.display="none",Swal.fire({title:"Success!",text:"Render Success,  "+globalThis.renderTimeText,icon:"success",button:"Ok"}),document.querySelector(".nodeExample1:last-of-type")?.scrollIntoView({behavior:"smooth",block:"center"})},500)}catch(e){Swal.fire({title:"Error",text:"Render Fail",icon:"error"})}}function getValidChildren(a,l){let n=[];return l.forEach((e,i)=>{if(checkValidChild(e,a)){let t={text:{caller:"Caller => "+a.name,...deleteUnwanted(prepareKeyValue(e))}};globalThis.paths[e.name]?.paths||(globalThis.paths[e.name]={paths:[]}),globalThis.paths[e.name].paths.push(a.name);var s=findErrors(e);s?.length&&(t.text.errors="Errors => "+s.join(" , "),t.index=i),globalThis.visitedSteps.has(e.name)?t.HTMLclass="circular_refrence":(globalThis.visitedSteps.add(e.name),t.children=getChildren(e,l)),s?.length&&!globalThis.stepsWithErrors?.find(e=>e.text?.name&&e.text?.name==t.text?.name)&&(delete(i=JSON.parse(JSON.stringify(t))).children,globalThis.stepsWithErrors.push(i)),globalThis.visitedSteps.add(e.name),n.push(t)}}),n}function renderValidGraph(){var e,t=performance.now(),i=(globalThis.tree&&globalThis.tree.destroy(),globalThis.visitedSteps=new Set,globalThis.stepsWithErrors=[],globalThis.paths={},globalThis?.selectedFlow?.steps);i&&(e=i.find(e=>e.isEntryPoint)||i[0],globalThis.entryPoint=e,globalThis.step={messages:"",interactiveType:"",type:"",action:"",success:"",fail:"",name:"",expected:"",next:"",clarification:"",effect:"",expiry:""},e={...step,...e},e={text:{"flow-name":"Flow Name :- "+globalThis?.selectedFlow.name+" | Total Steps Count:- "+globalThis?.selectedFlow?.steps?.length,...deleteUnwanted(prepareKeyValue(e)),isParent:"parent"},children:[...getValidChildren(e,removeDuplicateSteps(i))]},globalThis.tree=new Treant({chart:{container:"#flow-visualize",connectors:{type:"bCurve",style:{"arrow-end":"classic-wide-long","stroke-width":2,stroke:"#665B57"}},node:{HTMLclass:"nodeExample1"},maxDepth:1e4},nodeStructure:{...e}}),splitText(".node-expected"),splitText(".node-clarification","<br><br>"),splitText(".node-messages","<br><br>"),updateValues(),$(function(){let s=0;$(".nodeExample1").resizable({resize:function(e,t){var i;t.size.height=$(this).height(),t.size.width=30*Math.round(t.size.width/30),t.size.width>s?(i=Math.max(12-(t.size.width-s)/30,8),$(this).css({width:t.size.width+"px",height:t.size.height+"px",fontSize:i+"px"})):$(this).css({width:t.size.width+"px",height:t.size.height+"px",fontSize:"12px"}),s=t.size.width}})}),i=((performance.now()-t)/1e3).toFixed(2),e=Math.floor(i/60),t=(i%60).toFixed(2),globalThis.renderTimeText=`Render time: ${e} minutes and ${t} seconds`)}function checkValidChild(e,t){return!!e.name&&(!(![t.success,t.fail].includes(e.name)||!["action","time"].includes(t.type))||t.expiry?.step==e.name||t.next==e.name&&"break"==t.type||!(!checkExpected(t.expected,e.name)||!["message","failover"].includes(t.type)))}