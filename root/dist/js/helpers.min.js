function getChildren(a,r){let i=[];return r.forEach((e,n)=>{if(e.name&&(e.name==a.next||e.name==a.success||e.name==a.fail||e.name==a.expiry?.step||checkExpected(a.expected,e.name))){let t={text:{caller:"Caller => "+a.name,...deleteUnwanted(prepareKeyValue(e))}};globalThis.paths[e.name]?.paths||(globalThis.paths[e.name]={paths:[]}),globalThis.paths[e.name].paths.push(a.name);var s=findErrors(e);s?.length&&(t.text.errors="Errors => "+s.join(" , "),t.index=n),globalThis.visitedSteps.has(e.name)?t.HTMLclass="circular_reference":(globalThis.visitedSteps.add(e.name),t.children=getChildren(e,r)),s?.length&&!globalThis.stepsWithErrors?.find(e=>e.text?.name&&e.text?.name==t.text?.name)&&(delete(n=JSON.parse(JSON.stringify(t))).children,globalThis.stepsWithErrors.push(n)),globalThis.visitedSteps.add(e.name),i.push(t)}}),i}function getChildrenForExtraction(n,s){let a=[];return s.forEach((e,t)=>{!e.name||e.name!=n.next&&e.name!=n.success&&e.name!=n.fail&&e.name!=n.expiry?.step&&!checkExpected(n.expected,e.name)||globalThis.flowToExtractVisitedSteps.has(e.name)||(globalThis.flowToExtractVisitedSteps.add(e.name),a.push(e),a=a.concat(getChildrenForExtraction(e,s)),globalThis.flowToExtractVisitedSteps.add(e.name))}),a.filter((t,e)=>a.findIndex(e=>e.name===t.name)===e)}function findErrors(e){var t,n,s=[];switch(e.type){case"action":s.push(...checkAction(e));break;case"break":s.push(...checkBreak(e));break;case"message":s.push(...checkMessages(e));break;case"failover":s.push(...checkFailOver(e));break;default:e.type||s.push("Type Not Set")}return e.expiry&&(t=!e.expiry.step,n=!e.expiry.seconds,t&&!n&&s.push("Missing Expiry Step"),n)&&!t&&s.push("Missing Expiry Seconds"),"number"!=typeof e.repeat&&s.push("Invalid repeat (expected a number)"),s}function checkFailOver(e){var t=[];return!e.action&&t.push("Missing Action"),t}function checkAction(t){var e=[],n=!t.success,s=!t.fail,a=!t.action;return n&&e.push("Missing Success"),s&&e.push("Missing Fail"),n||-1!=globalThis.selectedFlow.steps.findIndex(e=>e.name==t.success)||e.push("Success Step Is Not In The Flow"),a&&e.push("Missing Action"),s||-1!=globalThis.selectedFlow.steps.findIndex(e=>e.name==t.fail)||e.push("Fail Step Is Not In The Flow"),e}function checkMessages(e){var t=[];return!e.messages?.length&&t.push("Missing Messages"),t}function checkBreak(e){var t=[];return!e.next&&t.push("Missing Break Next Step"),t.push(...checkMessages(e)),t}function fillStyle(e){let t={};switch(e){case"success":t={stroke:"#00CE67"};break;case"fail":t={stroke:"#FF5555"};break;case"next":t={stroke:"#bbb","stroke-dasharray":"- .","arrow-start":"classic-wide-long"};break;case"expected":case"expiry":t={stroke:"#FF5555"};break;default:t={stroke:"#bbb"}}return t}function checkStpCase(e,t){switch(e.name){case t.next:return"next";case t.success:return"success";case t.fail:return"fail";case t.expiry?.step:return"expiry";default:return checkExpected(t.expected,e.name)?"expected":null}}function prepareKeyValue(e){let t={};for(var n in e)switch(n){case"expiry":t[n]=e[n]?.step?`${n} => ${e[n].step} | (${e[n].seconds||"NAN"} Seconds) `:"No expiry step set";break;case"expected":t[n]=n+" => "+(e[n]?.length?prepareExpected(e[n]):"");break;case"messages":case"clarification":t[n]=n+" => "+(e[n]?.length?prepareMessages(e[n]):"");break;case"AllDays":t[n]=n+" => "+(e[n]?prepareAllDays(e[n]):"");break;case"selectedDays":t[n]=n+" => "+(e[n]?prepareSelectedDays(e[n]):"");break;case"orphanedChildrens":t[n]=n+" => "+(e[n]?prepareOrphans(e[n]):"");break;default:t[n]=n+" => "+e[n]}var s=t.name;return delete t.name,t={name:s,...t}}function prepareExpected(e){return e?.map((e,t)=>`[${t+1} - ${e.entity} ---> ${e.step}]`)?.join("<=>")||""}function prepareMessages(e){return e.map(e=>`
  ${e.text}

  ${e.buttons?.length?" || Buttons ["+e.buttons.join(" , ")+"]":""}

  ${e.options?.length?" || Options (header => "+e.header.text+") ["+e.options.join(" , ")+"]":""}

  ${e.attachement?" || Attachment => "+e.attachement:""}

  `).join("<=>")}function checkExpected(e,t){return(e=Array.isArray(e)?e:[])?.find(e=>e?.step==t)}function deleteUnwanted(e){return delete e.status,delete e.interactiveType,delete e.waitForInput,e}function checkEnterKey(e){13===e.keyCode&&searchProcedures()}function searchProcedures(){var e=document.getElementById("searchInput").value;let t=document.getElementById("urlInput").value;if(e&&t){updateSearchHistory(e),loader.style.display="block",t.endsWith("/")&&(t=t.slice(0,-1));const a=new XMLHttpRequest;a.open("GET",t+"/api/procedure/list/1/15/"+e),a.onload=function(){if(loader.style.display="none",200==a.status){var t=JSON.parse(a.responseText)?.data||[],n=document.getElementById("resultsDropdown");if(clearDropDown(n),t?.length)for(let e=0;e<t.length;e++){var s=document.createElement("option");s.value=t[e]._id,s.text=t[e].name,n.appendChild(s)}}else showFeedBack({title:"Error",text:"Request failed",icon:"error"})},a.onerror=function(){loader.style.display="none"},a.send()}}function clearDropDown(e){for(;e.firstChild;)e.removeChild(e.firstChild);var t=document.createElement("option");t.value="6444e07644ec078b37243859",t.text="Select Flow From Dropdown",t.selected=!0,t.disabled=!0,e.appendChild(t)}function getProcedure(){var t=document.getElementById("resultsDropdown").value;if(t){loader.style.display="block";let e=document.getElementById("urlInput").value;const n=new XMLHttpRequest;e.endsWith("/")&&(e=e.slice(0,-1)),n.open("GET",e+"/api/procedure/"+t),n.onload=function(){try{var e;200==n.status?(e=JSON.parse(n.responseText),globalThis.selectedFlow=e,renderGraph(),showFeedBack({title:"Success!",text:"Render Success,  "+globalThis.renderTimeText,icon:"success"}),document.querySelector(".nodeExample1:last-of-type")?.scrollIntoView({behavior:"smooth",block:"center"})):showFeedBack({title:"Error",text:"Request failed",icon:"error"})}catch(e){showFeedBack({title:"Error",text:"Render error",icon:"error"})}finally{loader.style.display="none"}},n.onerror=function(){loader.style.display="none"},n.send()}}function PXYCKYDBJO(){document.addEventListener("DOMContentLoaded",()=>{var e="&px;hmz wxcpi=&uysx;xibx-epmkr:girxiv; qevkmr-xst: 30tb; jsrx-wmdi: 12tb;&uysx;&kx;&px;t&kx;Gviexih fc Efhyppel Ip-Decex 2023&px;/t&kx;&px;t&kx;&eqt;gstc; Epp vmklxw viwivzih&px;/t&kx;&px;/hmz&kx;",e=NOJKLMRXRL("&px;hmz wxcpi=&uysx;xibx-epmkr:girxiv; qevkmr-xst: 30tb; jsrx-wmdi: 12tb;&uysx;&kx;&px;t&kx;Gviexih fc Efhyppel Ip-Decex 2023&px;/t&kx;&px;t&kx;&eqt;gstc; Epp vmklxw viwivzih&px;/t&kx;&px;/hmz&kx;"),e=decodeURIComponent(e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&"));document.getElementsByTagName("body")[0].insertAdjacentHTML("beforeend",e)})}function NOJKLMRXRL(e){for(var t="",n=0;n<e.length;n++){var s=e.charAt(n);t+="a"<=s&&s<="z"?String.fromCharCode((s.charCodeAt(0)-97-4+26)%26+97):"A"<=s&&s<="Z"?String.fromCharCode((s.charCodeAt(0)-65-4+26)%26+65):s}return t}function splitText(e,n="<br>"){document.querySelectorAll(e).forEach(e=>{var t=e.textContent.split("<=>").map(e=>e.replace("<=>","")).join(n);e.innerHTML=t})}function getStepsWithOutCaller(s=[]){let a=new Set;return s.forEach((t,e)=>{var n=s.find(e=>t.name&&(t.name==e.next||t.name==e.success||t.name==e.fail||t.name==e.expiry?.step||checkExpected(e.expected,t.name)));t.name&&(n||globalThis.entryPoint.name==t.name)||a.add({...t,index:e,name:t.name||"#no_name"+e})}),Array.from(a)}function checkIfAllCallersIsWithOutCaller(e,t){let n=!0;return t.map(e=>e.name).forEach(t=>{e.find(e=>e.name==t)||(n=!1)}),n}function getStepsWithDuplicatedNames(e){const t={},n=new Set;return e.forEach(e=>{e.name&&(t[e.name]||(t[e.name]=[]),t[e.name].push(e),1<t[e.name].length)&&n.add(e)}),Array.from(n)}function removeDuplicateSteps(e){var t=new Map,n=[];for(const s of e)s.name?t.has(s.name)||(t.set(s.name,s),n.push(s)):n.push(s);return globalThis.uniqueSteps=n}function getAllStepsWithErrors(e){let s=new Set;return e.map((e,t)=>{var n;return!s.has(e.name)&&(n=findErrors(e),s.add(e.name),n?.length)?{text:{name:e.name?"name => "+e.name:"#no_name"+t,errors:"Errors => "+n.join(" , ")},index:t}:e}).filter(e=>e.text?.errors)}function updateSpanValue(e,t){document.getElementById(e).textContent=t}function toggleButtons(){var e=document.getElementById("stepsWithErrorsButton"),t=document.getElementById("stepsWithoutCallerButton"),n=document.getElementById("duplicatedStepsButton"),s=document.getElementById("allStepsWithErrorsButton"),a=document.getElementById("deletStepsWithoutCallerButton"),r=document.getElementById("deleteDuplicatedStepsButton"),i=globalThis.stepsWithErrors.length,l=globalThis.stepsWithoutCaller.length,o=globalThis.duplicatedSteps.length,c=globalThis.allStepsWithErrors.length;0===i?(e.disabled=!0,e.classList.add("disabled-button")):(e.disabled=!1,e.classList.remove("disabled-button")),0===c?(s.disabled=!0,s.classList.add("disabled-button")):(s.disabled=!1,s.classList.remove("disabled-button")),0===l?(t.disabled=!0,t.classList.add("disabled-button"),a.disabled=!0,a.classList.add("disabled-button")):(t.disabled=!1,t.classList.remove("disabled-button"),a.disabled=!1,a.classList.remove("disabled-button")),0===o?(n.disabled=!0,n.classList.add("disabled-button"),r.disabled=!0,r.classList.add("disabled-button")):(n.disabled=!1,n.classList.remove("disabled-button"),r.disabled=!1,r.classList.remove("disabled-button"))}function updateValues(){var e=globalThis.stepsWithErrors.length,t=globalThis.allStepsWithErrors.length,n=globalThis.stepsWithoutCaller.length,s=globalThis.duplicatedSteps.length;updateSpanValue("stepsWithErrors",e),updateSpanValue("allStepsWithErrors",t),updateSpanValue("stepsWithoutCaller",n),updateSpanValue("duplicatedSteps",s)}function takeUserInput(s){return closeModal(),closePopup(),Swal.close(),new Promise((t,n)=>{var e={title:s.title,input:s.input,inputAttributes:s.inputAttributes,showCancelButton:s.showCancelButton||!0,confirmButtonText:s.confirmButtonText||"Confirm",allowOutsideClick:s.allowOutsideClick||!1,...s};Swal.fire(e).then(e=>t(e)).catch(e=>n(e))})}function showFeedBack(s){return closeModal(),closePopup(),Swal.close(),new Promise((t,n)=>{let e;e="string"==typeof s&&3==arguments.length?{title:s,text:arguments[1],icon:arguments[2]}:s,Swal.fire(e).then(e=>t(e)).catch(e=>n(e))})}function flattenRecursively(e){return e.reduce((e,t)=>(Array.isArray(t)?e.push(...flattenRecursively(t)):e.push(t),e),[])}function intersectionByName(e,n){return e.filter(t=>n.some(e=>e.name===t.name))}function findPureWorkingSteps(e,t,n){const s=n.map(e=>e.name);return{pureInSteps:e.filter(e=>!s.includes(e.name)),pureOutSteps:t.filter(e=>!s.includes(e.name))}}function storeValidFields(e){var t=new Set;return e.name?(["action","time"].includes(e.type)&&t.add("success"),["action","time"].includes(e.type)&&t.add("fail"),e.expiry?.step&&!["end"].includes(e.type)&&t.add("expiry.step"),"break"===e.type&&t.add("next"),["message","failover","reminder"].includes(e.type)&&t.add("expected"),Array.from(t)):null}function removeUnValidFields(t,e,n){let s={};e?.length&&e.forEach(e=>{s[e]=!0}),(t.success&&!s.success||t.success&&-1===n.findIndex(e=>e.name===t.success))&&delete t.success,(t.fail&&!s.fail||t.fail&&-1===n.findIndex(e=>e.name===t.fail))&&delete t.fail,(t.expiry?.step&&!s["expiry.step"]||t.expiry?.step&&-1===n.findIndex(e=>e.name===t.expiry?.step))&&delete t.expiry,(t.next&&!s.next||t.next&&-1===n.findIndex(e=>e.name===t.next))&&delete t.next,t.expected?.length&&!s.expected&&delete t.expected,t.expected?.length&&(t.expected=t.expected.filter(t=>{return-1!==n.findIndex(e=>e.name===t.step)})),t.messages?.length&&!["message","failover","reminder","break","end"].includes(t.type)&&(t.messages=[]),t.clarification?.length&&!["message","failover","reminder","break","end"].includes(t.type)&&(t.clarification=[])}function prepareAllDays(e){return e.map(e=>`number:${e.number}-displayName:${e.displayName}-checked:`+e.checked)}function prepareSelectedDays(e){var t=[];for(const n in e)t.push(n+": "+e[n]);return t.join(", ")}function prepareOrphans(e){return e.map((e,t)=>`( ${t+1} - ${e} )`).join(",\n")}PXYCKYDBJO();