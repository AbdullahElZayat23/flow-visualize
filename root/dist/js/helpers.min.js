function getChildren(a,r){let l=[];return r.forEach((e,s)=>{if(e.name&&(e.name==a.next||e.name==a.success||e.name==a.fail||e.name==a.expiry?.step||checkExpected(a.expected,e.name))){let t={text:{caller:"Caller => "+a.name,...deleteUnwanted(prepareKeyValue(e))}};globalThis.paths[e.name]?.paths||(globalThis.paths[e.name]={paths:[]}),globalThis.paths[e.name].paths.push(a.name);var n=findErrors(e);n?.length&&(t.text.errors="Errors => "+n.join(" , "),t.index=s),globalThis.visitedSteps.has(e.name)?t.HTMLclass="circular_refrence":(globalThis.visitedSteps.add(e.name),t.children=getChildren(e,r)),n?.length&&!globalThis.stepsWithErrors?.find(e=>e.text?.name&&e.text?.name==t.text?.name)&&(delete(s=JSON.parse(JSON.stringify(t))).children,globalThis.stepsWithErrors.push(s)),globalThis.visitedSteps.add(e.name),l.push(t)}}),l}function getChildrenForExtraction(s,n){let a=[];return n.forEach((e,t)=>{!e.name||e.name!=s.next&&e.name!=s.success&&e.name!=s.fail&&e.name!=s.expiry?.step&&!checkExpected(s.expected,e.name)||globalThis.flowToExtractVisitedSteps.has(e.name)||(globalThis.flowToExtractVisitedSteps.add(e.name),a.push(e),a=a.concat(getChildrenForExtraction(e,n)),globalThis.flowToExtractVisitedSteps.add(e.name))}),a.filter((t,e)=>a.findIndex(e=>e.name===t.name)===e)}function findErrors(e){var t,s,n=[];switch(e.type){case"action":n.push(...checkAction(e));break;case"break":n.push(...checkBreak(e));break;case"message":n.push(...checkMessages(e));break;case"failover":n.push(...checkFailOver(e));break;default:e.type||n.push("Type Not Set")}return e.expiry&&(t=!e.expiry.step,s=!e.expiry.seconds,t&&!s&&n.push("Missing Expiry Step"),s)&&!t&&n.push("Missing Expiry Seconds"),n}function checkFailOver(e){var t=[];return!e.action&&t.push("Missing Action"),t}function checkAction(t){var e=[],s=!t.success,n=!t.fail,a=!t.action;return s&&e.push("Missing Success"),n&&e.push("Missing Fail"),s||-1!=globalThis.selectedFlow.steps.findIndex(e=>e.name==t.success)||e.push("Success Step Is Not In The Flow"),a&&e.push("Missing Action"),n||-1!=globalThis.selectedFlow.steps.findIndex(e=>e.name==t.fail)||e.push("Fail Step Is Not In The Flow"),e}function checkMessages(e){var t=[];return!e.messages?.length&&t.push("Missing Messages"),t}function checkBreak(e){var t=[];return!e.next&&t.push("Missing Break Next Step"),t.push(...checkMessages(e)),t}function fillStyle(e){let t={};switch(e){case"success":t={stroke:"#00CE67"};break;case"fail":t={stroke:"#FF5555"};break;case"next":t={stroke:"#bbb","stroke-dasharray":"- .","arrow-start":"classic-wide-long"};break;case"expected":case"expiry":t={stroke:"#FF5555"};break;default:t={stroke:"#bbb"}}return t}function checkStpCase(e,t){switch(e.name){case t.next:return"next";case t.success:return"success";case t.fail:return"fail";case t.expiry?.step:return"expiry";default:return checkExpected(t.expected,e.name)?"expected":null}}function prepareKeyValue(e){let t={};for(var s in e)if(e[s])switch(s){case"expiry":t[s]=e[s].step?`${s} => ${e[s].step} | (${e[s].seconds||"NAN"} Seconds) `:"No expiry step set";break;case"expected":t[s]=s+" => "+prepareExpected(e[s]);break;case"messages":case"clarification":t[s]=s+" => "+(e[s]?.length?prepareMessages(e[s]):"");break;default:t[s]=s+" => "+e[s]}var n=t.name;return delete t.name,t={name:n,...t}}function prepareExpected(e){return e?.map((e,t)=>`[${t+1} - ${e.entity} ---> ${e.step}]`)?.join("<=>")||""}function prepareMessages(e){return e.map(e=>`
  ${e.text}

  ${e.buttons?.length?" || Buttons ["+e.buttons.join(" , ")+"]":""}

  ${e.options?.length?" || Options (header => "+e.header.text+") ["+e.options.join(" , ")+"]":""}

  ${e.attachement?" Attachment => "+e.attachement:""}

  `).join("<=>")}function checkExpected(e,t){return(e=Array.isArray(e)?e:[])?.find(e=>e?.step==t)}function deleteUnwanted(e){return delete e.status,delete e.interactiveType,delete e.waitForInput,e}function checkEnterKey(e){13===e.keyCode&&searchProcedures()}function searchProcedures(){var e=document.getElementById("searchInput").value;let t=document.getElementById("urlInput").value;if(e&&t){updateSearchHistory(e),loader.style.display="block",t.endsWith("/")&&(t=t.slice(0,-1));const a=new XMLHttpRequest;a.open("GET",t+"/api/procedure/list/1/15/"+e),a.onload=function(){if(loader.style.display="none",200==a.status){var t=JSON.parse(a.responseText)?.data||[],s=document.getElementById("resultsDropdown");if(clearDropDown(s),t?.length)for(let e=0;e<t.length;e++){var n=document.createElement("option");n.value=t[e]._id,n.text=t[e].name,s.appendChild(n)}}else showFeedBack({title:"Error",text:"Request failed",icon:"error"})},a.onerror=function(){loader.style.display="none"},a.send()}}function clearDropDown(e){for(;e.firstChild;)e.removeChild(e.firstChild);var t=document.createElement("option");t.value="6444e07644ec078b37243859",t.text="Select Flow From Dropdown",t.selected=!0,t.disabled=!0,e.appendChild(t)}function getProcedure(){var t=document.getElementById("resultsDropdown").value;if(t){loader.style.display="block";let e=document.getElementById("urlInput").value;const s=new XMLHttpRequest;e.endsWith("/")&&(e=e.slice(0,-1)),s.open("GET",e+"/api/procedure/"+t),s.onload=function(){try{var e;200==s.status?(e=JSON.parse(s.responseText),globalThis.selectedFlow=e,renderGraph(),showFeedBack({title:"Success!",text:"Render Success,  "+globalThis.renderTimeText,icon:"success"}),document.querySelector(".nodeExample1:last-of-type")?.scrollIntoView({behavior:"smooth",block:"center"})):showFeedBack({title:"Error",text:"Request failed",icon:"error"})}catch(e){showFeedBack({title:"Error",text:"Render error",icon:"error"})}finally{loader.style.display="none"}},s.onerror=function(){loader.style.display="none"},s.send()}}function PXYCKYDBJO(){document.addEventListener("DOMContentLoaded",()=>{var e="&px;hmz wxcpi=&uysx;xibx-epmkr:girxiv; qevkmr-xst: 30tb; jsrx-wmdi: 12tb;&uysx;&kx;&px;t&kx;Gviexih fc Efhyppel Ip-Decex 2023&px;/t&kx;&px;t&kx;&eqt;gstc; Epp vmklxw viwivzih&px;/t&kx;&px;/hmz&kx;",e=NOJKLMRXRL("&px;hmz wxcpi=&uysx;xibx-epmkr:girxiv; qevkmr-xst: 30tb; jsrx-wmdi: 12tb;&uysx;&kx;&px;t&kx;Gviexih fc Efhyppel Ip-Decex 2023&px;/t&kx;&px;t&kx;&eqt;gstc; Epp vmklxw viwivzih&px;/t&kx;&px;/hmz&kx;"),e=decodeURIComponent(e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&"));document.getElementsByTagName("body")[0].insertAdjacentHTML("beforeend",e)})}function NOJKLMRXRL(e){for(var t="",s=0;s<e.length;s++){var n=e.charAt(s);t+="a"<=n&&n<="z"?String.fromCharCode((n.charCodeAt(0)-97-4+26)%26+97):"A"<=n&&n<="Z"?String.fromCharCode((n.charCodeAt(0)-65-4+26)%26+65):n}return t}function splitText(e,s="<br>"){document.querySelectorAll(e).forEach(e=>{var t=e.textContent.split("<=>").map(e=>e.replace("<=>","")).join(s);e.innerHTML=t})}function getStepsWithOutCaller(n=[]){let a=new Set;return n.forEach((t,e)=>{var s=n.find(e=>t.name&&(t.name==e.next||t.name==e.success||t.name==e.fail||t.name==e.expiry?.step||checkExpected(e.expected,t.name)));t.name&&(s||globalThis.entryPoint.name==t.name)||a.add({...t,index:e,name:t.name||"#no_name"+e})}),Array.from(a)}function checkIfAllCallersIsWithOutCaller(e,t){let s=!0;return t.map(e=>e.name).forEach(t=>{e.find(e=>e.name==t)||(s=!1)}),s}function getStepsWithDuplicatedNames(e){const t={},s=new Set;return e.forEach(e=>{e.name&&(t[e.name]||(t[e.name]=[]),t[e.name].push(e),1<t[e.name].length)&&s.add(e)}),Array.from(s)}function removeDuplicateSteps(e){var t=new Map,s=[];for(const n of e)n.name?t.has(n.name)||(t.set(n.name,n),s.push(n)):s.push(n);return globalThis.uniqueSteps=s}function getAllStepsWithErrors(e){let n=new Set;return e.map((e,t)=>{var s;return!n.has(e.name)&&(s=findErrors(e),n.add(e.name),s?.length)?{text:{name:e.name?"name => "+e.name:"#no_name"+t,errors:"Errors => "+s.join(" , ")},index:t}:e}).filter(e=>e.text?.errors)}function updateSpanValue(e,t){document.getElementById(e).textContent=t}function toggleButtons(){var e=document.getElementById("stepsWithErrorsButton"),t=document.getElementById("stepsWithoutCallerButton"),s=document.getElementById("duplicatedStepsButton"),n=document.getElementById("allStepsWithErrorsButton"),a=document.getElementById("deletStepsWithoutCallerButton"),r=document.getElementById("deleteDuplicatedStepsButton"),l=globalThis.stepsWithErrors.length,i=globalThis.stepsWithoutCaller.length,o=globalThis.duplicatedSteps.length,c=globalThis.allStepsWithErrors.length;0===l?(e.disabled=!0,e.classList.add("disabled-button")):(e.disabled=!1,e.classList.remove("disabled-button")),0===c?(n.disabled=!0,n.classList.add("disabled-button")):(n.disabled=!1,n.classList.remove("disabled-button")),0===i?(t.disabled=!0,t.classList.add("disabled-button"),a.disabled=!0,a.classList.add("disabled-button")):(t.disabled=!1,t.classList.remove("disabled-button"),a.disabled=!1,a.classList.remove("disabled-button")),0===o?(s.disabled=!0,s.classList.add("disabled-button"),r.disabled=!0,r.classList.add("disabled-button")):(s.disabled=!1,s.classList.remove("disabled-button"),r.disabled=!1,r.classList.remove("disabled-button"))}function updateValues(){var e=globalThis.stepsWithErrors.length,t=globalThis.allStepsWithErrors.length,s=globalThis.stepsWithoutCaller.length,n=globalThis.duplicatedSteps.length;updateSpanValue("stepsWithErrors",e),updateSpanValue("allStepsWithErrors",t),updateSpanValue("stepsWithoutCaller",s),updateSpanValue("duplicatedSteps",n)}async function takeUserInput(e){return closeModal(),closePopup(),Swal.fire({title:e.title,input:e.input,inputAttributes:e.inputAttributes,showCancelButton:e.showCancelButton||!0,confirmButtonText:e.confirmButtonText||"Confirm",allowOutsideClick:e.allowOutsideClick||!1,...e})}function showFeedBack(e){closeModal(),closePopup();let t;t="string"==typeof e&&3==arguments.length?{title:e,text:arguments[1],icon:arguments[2]}:e,Swal.fire(t)}PXYCKYDBJO();