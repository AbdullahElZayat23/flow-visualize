let popup=document.getElementById("popup");function showPopup(){popup.classList.add("active"),toggleButtons()}function closePopup(){popup.classList.remove("active")}function optionSelected(e){if(globalThis.selectedFlow?.name&&globalThis.selectedFlow?.steps?.length)switch(e){case"1":showReport(globalThis.stepsWithErrors.map(e=>({Name:e.text.name.replace("name => ",""),Errors:e.text.errors.replace("Errors => ",""),index:e.index})),["Name","Errors","Index"],globalThis.selectedFlow.name,"steps-with-erros");break;case"2":showReport(globalThis.stepsWithoutCaller.map(e=>({Name:e.name,Template:e.template,index:e.index})),["Name","Is template","Index"],globalThis.selectedFlow.name,"steps-without-caller");break;case"3":showReport(globalThis.duplicatedSteps.map(e=>({Name:e.name})),["Name"],globalThis.selectedFlow.name,"duplicated-steps");break;case"4":showReport(globalThis.allStepsWithErrors.map(t=>({Name:t.text.name.replace("name => ",""),Errors:t.text.errors.replace("Errors => ",""),index:t.index,hasCaller:!globalThis.stepsWithoutCaller.find(e=>e.name==t.text.name.replace("name => ",""))})),["Name","Errors","Index","Has caller"],globalThis.selectedFlow.name,"all-steps-with-errors");break;case"5":showModal(),removeOptions(),addOptions(globalThis.uniqueSteps)}else swal({title:"No Steps To Filter",text:"There are no steps to filter at the moment. Please redner a flow first",icon:"info"});closePopup()}function extractSteps(){let e=[],t=document.getElementById("steps_type").value;if(t){switch(t){case"template":e=globalThis.selectedFlow.steps.filter(e=>e.template);break;case"none":e=globalThis.selectedFlow.steps.filter(e=>!e.type);break;default:e=globalThis.selectedFlow.steps.filter(e=>e.type==t)}closeModal(),e.length?exportFlow({steps:e,name:globalThis.selectedFlow.name}):swal({title:"No Steps Found With The Choosen Criteria",text:"There are no steps With The Choosen Criteria",icon:"info"})}}function showModal(){document.getElementById("moreModal").classList.add("active")}function closeModal(){document.getElementById("moreModal").classList.remove("active")}function showReport(e,t,o,s){e?.length&&createTable(e,t,o,s)}function createTable(e,t,o,s){var l=XLSX.utils.book_new(),e=XLSX.utils.json_to_sheet(e);XLSX.utils.sheet_add_aoa(e,[t],{origin:"A1"}),XLSX.utils.book_append_sheet(l,e,"Steps With Errors"),XLSX.writeFile(l,`${o}-${s}-${(new Date).toISOString()}.xlsx`)}function searchStep(){closeModal();var e=parseInt(document.getElementById("step-number").value);let t;try{if(!(t=globalThis.selectedFlow?.steps[e]))return void swal({title:"Step not Found",text:"There is no step in the tree with the index you entered, or the step has no name. Please check your inputs.",icon:"info"})}catch(e){return void swal({title:"Step not Found",text:"There is no step in the tree with the index you entered, or the step has no name. Please check your inputs.",icon:"info"})}let o=null;var s=document.querySelectorAll(".nodeExample1 p.node-name");for(let e=0;e<s.length;e++)if(s[e].textContent.trim()==="name => "+t?.name&&![...s[e].parentNode.classList].includes("circular_refrence")){o=s[e].parentNode;break}o?(o.scrollIntoView({behavior:"smooth",block:"center"}),o.style.backgroundColor="#ffffcc",setTimeout(function(){o.style.backgroundColor=""},4e3)):swal({title:"Step not Found",text:"There is no step in the tree with the index you entered, or the step has no name. Please check your inputs.",icon:"info"})}function addOptions(e){var t=document.getElementById("steps_dropdown"),e=e?.map(e=>{var t=document.createElement("option");return t.text=e.name,t.value=e.name,t});e?.length&&(t.append(...e),updateDropdown())}function removeOptions(){document.getElementById("steps_dropdown").innerHTML="",updateDropdown()}function updateDropdown(){var e=document.getElementById("steps_dropdown");e.fstdropdown&&e.fstdropdown.rebind()}function extractFlow(){const t=document.getElementById("steps_dropdown")?.value;var e,o=globalThis.selectedFlow?.steps.find(e=>e.name==t);closeModal(),o?(loader.style.display="block",globalThis.flowToExtractVisitedSteps=new Set,(e=kixGlmphvirJsvIbxvegxmsr(o,globalThis.selectedFlow.steps)).unshift(o),o={...globalThis.selectedFlow,steps:e},exportFlow(o)):swal({title:"No Step Found With The Entered Name",text:"Make Sure Step Name Is Correct.",icon:"info"})}function mergeSteps(){if(closeModal(),globalThis.uploadedFileJSOnsData?.steps?.length){var e=globalThis.selectedFlow.steps,t=globalThis.uploadedFileJSOnsData.steps;const o=new Map;e.forEach(e=>{o.set(e.name,e)}),t.forEach(e=>{o.set(e.name,e)}),exportFlow({...globalThis.selectedFlow,steps:Array.from(o.values())},{name:globalThis.selectedFlow.name+"-merged"})}else swal({title:"Select Data Source",text:"Select Data Source To Merge From",icon:"info"})}function addStep(){closeModal();var e=document.getElementById("step-text-area").value;let t,s=[],o=[];try{t=JSON.parse(e)}catch(e){return void swal("Error","Failed to parse JSON data. Please make sure the inserted step/s contains valid / pure JSON data.","error")}(t=Array.isArray(t)?t:[t]).forEach((e,t)=>{var o=jmrhIvvsvw(e);o.length&&s.push({name:e.name,errors:o})}),t.forEach(t=>{globalThis.selectedFlow.steps.find(e=>e.name==t.name)&&o.push(t)}),o.length?(showReport(o.map(e=>({Name:e.name})),["Name"],"new steps","inserted-steps-with-duplication"),swal("Error","Inserted Steps Contains Duplication, See The Exported Sheet For The Details.","error")):s.length?(showReport(s.map(e=>({Name:e.name,Errors:e.errors.join(", ")})),["Name","Errors"],"new steps","inserted-steps-with-errors"),swal("Error","Inserted Steps Contains Errors, See The Exported Sheet For The Details.","error")):(e=globalThis.selectedFlow.steps.concat(t),e={...globalThis.selectedFlow,steps:e},updateFlowVisualization(e))}